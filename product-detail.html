<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chi tiết sản phẩm - Shop Hoa Tươi</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="product-detail.css" />
    <script src="cart.js"></script>
  </head>
  <body>
    <!-- Modal Overlay -->
    <div class="modal-overlay">
      <!-- Modal Container -->
      <div class="modal-container">
        <!-- Close Button -->
        <button class="close-btn" onclick="goBackToProducts()">
          <i class="fas fa-times"></i>
        </button>

        <!-- Hotline Header -->
        <div class="hotline-header">
          HOTLINE ĐẶT HOA NHANH - TP HCM: 1900 633 045 - HÀ NỘI: 094 200 7921
        </div>

        <!-- Main Container -->
        <div class="container">
          <div class="product-detail">
            <!-- Product Image -->
            <div class="product-image-section">
              <img
                id="productImage"
                src="src/img/Anhsao.webp"
                alt="Ấm Sao"
                class="main-image"
              />
            </div>

            <!-- Product Info -->
            <div class="product-info">
              <h1 id="productTitle" class="product-title">Ấm Sao</h1>
              <div id="productPrice" class="product-price">790,000VND</div>
              <div class="vat-note">Giá đã bao gồm 8% VAT</div>

              <!-- Promotions Section -->
              <div class="promotions-section">
                <div class="promo-label">Khuyến mãi:</div>
                <div class="promo-tags">
                  <span class="promo-tag">Giảm 50K</span>
                  <span class="promo-tag">Giảm 25K</span>
                  <span class="promo-tag">Giảm 10%</span>
                </div>
              </div>

              <!-- Services Section -->
              <div class="services-section">
                <div class="service-item">
                  <div class="service-icon">
                    <i class="fas fa-truck"></i>
                  </div>
                  <div class="service-text">
                    <div class="service-title">Giao hoa</div>
                    <div class="service-subtitle">MIỄN PHÍ</div>
                  </div>
                </div>
                <div class="service-item">
                  <div class="service-icon">
                    <i class="fas fa-heart"></i>
                  </div>
                  <div class="service-text">
                    <div class="service-title">Tặng kèm</div>
                    <div class="service-subtitle">THIỆP/BANNER</div>
                  </div>
                </div>
                <div class="service-item">
                  <div class="service-icon">
                    <i class="fas fa-clock"></i>
                  </div>
                  <div class="service-text">
                    <div class="service-title">Giao nhanh</div>
                    <div class="service-subtitle">60 PHÚT</div>
                  </div>
                </div>
              </div>

              <!-- Purchase Section -->
              <div class="purchase-section">
                <div class="quantity-section">
                  <div class="quantity-label">Số lượng</div>
                  <div class="quantity-controls">
                    <button class="qty-btn" onclick="changeQuantity(-1)">
                      -
                    </button>
                    <span class="quantity-display" id="quantity">1</span>
                    <button class="qty-btn" onclick="changeQuantity(1)">
                      +
                    </button>
                  </div>
                </div>

                <button class="main-order-btn" onclick="orderNow()">
                  <i class="fas fa-shopping-cart"></i>
                  ĐẶT HOA NGAY
                </button>

                <!-- Contact Buttons -->
                <div class="contact-buttons">
                  <button class="contact-btn contact-phone">
                    <i class="fas fa-phone"></i>
                    Đặt nhanh
                  </button>
                  <button class="contact-btn contact-zalo">
                    <i class="fab fa-facebook-messenger"></i>
                    Zalo QA
                  </button>
                  <button class="contact-btn contact-facebook">
                    <i class="fab fa-facebook-messenger"></i>
                    Facebook
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Detailed Product Description -->
        <div class="container">
          <div class="detailed-description">
            <h2>Mô tả chi tiết sản phẩm</h2>
            <div id="detailedContent">
              <p>
                <strong>Bó hoa "Ấm Sao"</strong> là một tác phẩm nghệ thuật được
                tạo nên từ những bông hoa hồng tươi thắm nhất, mang đến vẻ đẹp
                tinh tế và sang trọng cho người nhận.
              </p>

              <h3>Đặc điểm nổi bật:</h3>
              <ul>
                <li>
                  <strong>Hoa hồng cao cấp:</strong> Sử dụng 30-35 bông hoa hồng
                  tươi nhập khẩu từ Đà Lạt, được chọn lọc kỹ càng
                </li>
                <li>
                  <strong>Màu sắc nhẹ nhàng:</strong> Tông màu hồng pastel kết
                  hợp trắng tinh khôi tạo nên vẻ đẹp dịu dàng
                </li>
                <li>
                  <strong>Lá phụ tự nhiên:</strong> Eucalyptus và baby breath
                  tạo điểm nhấn tinh tế và thơm mát
                </li>
                <li>
                  <strong>Gói hoa đẹp mắt:</strong> Giấy gói cao cấp màu trắng
                  với ruy băng hồng sang trọng
                </li>
                <li>
                  <strong>Kích thước:</strong> Cao 50cm, đường kính 35cm - kích
                  thước hoàn hảo để thể hiện tình cảm
                </li>
                <li>
                  <strong>Thời gian tươi:</strong> 7-10 ngày nếu chăm sóc đúng
                  cách
                </li>
              </ul>

              <h3>Ý nghĩa và phù hợp cho:</h3>
              <p>
                Bó hoa "Ấm Sao" mang trong mình thông điệp về tình yêu ấm áp và
                sự quan tâm chân thành. Những bông hoa hồng được sắp xếp một
                cách tinh tế, tạo nên một tổng thể harmonious và đầy cảm xúc.
              </p>
              <p>
                <strong>Thích hợp cho các dịp:</strong> Sinh nhật, kỷ niệm ngày
                cưới, cầu hôn, Valentine, Ngày Phụ nữ Việt Nam (20/10), Ngày
                Quốc tế Phụ nữ (8/3), hay đơn giản là để bày trang trí nhà cửa,
                văn phòng.
              </p>

              <h3>Hướng dẫn chăm sóc:</h3>
              <ul>
                <li>Cắt chéo cuống hoa dưới vòi nước chảy ngay khi nhận</li>
                <li>Đặt hoa trong bình nước sạch, thay nước 2-3 ngày/lần</li>
                <li>Tránh ánh nắng trực tiếp và gió mạnh</li>
                <li>
                  Cắt bỏ những bông hoa đã héo để giữ độ tươi cho những bông
                  khác
                </li>
              </ul>

              <p class="note">
                <em
                  ><strong>Lưu ý:</strong> Màu sắc và số lượng hoa có thể thay
                  đổi nhẹ tùy theo tình hình thực tế và mùa vụ, nhưng chúng tôi
                  cam kết luôn giữ nguyên giá trị thẩm mỹ và chất lượng của sản
                  phẩm. Mỗi bó hoa đều được thiết kế riêng biệt bởi đội ngũ
                  florist chuyên nghiệp.</em
                >
              </p>
            </div>
          </div>
        </div>

        <script>
              // Get product info from URL parameters
              function getProductFromURL() {
                  const urlParams = new URLSearchParams(window.location.search);
                  const productName = urlParams.get('name');
                  const productPrice = urlParams.get('price');
                  const productImage = urlParams.get('image');

                  if (productName && productPrice && productImage) {
                      document.getElementById('productTitle').textContent = productName;
                      document.getElementById('productPrice').textContent = productPrice;
                      document.getElementById('productImage').src = productImage;
                      document.getElementById('productImage').alt = productName;

                      // Update description based on product
                      updateProductDescription(productName);
                  }
              }

              // Update product description based on product name
              function updateProductDescription(productName) {
                  const descriptions = {
                      'Little Love': 'là biểu tượng của tình yêu nhỏ bé nhưng chân thành, được tạo nên từ những bông hoa hồng mini đáng yêu.',
                      'Ngọt Ngão': 'mang đến cảm giác ấm áp và ngọt ngào như tình yêu đầu đời với những tông màu pastel dịu dàng.',
                      'Ấm Sao': 'được tạo nên từ những bông hoa hồng tươi thắm nhất, mang đến vẻ đẹp tinh tế và sang trọng.',
                      '100 Ngày Yêu': 'là món quà hoàn hảo thể hiện tình yêu bền vững với sự kết hợp harmonious của nhiều loại hoa.',
                      'Bó Hoa Bright Pink': 'nổi bật với sắc hồng rực rỡ, tạo nên điểm nhấn tươi mới và năng động.',
                      'Missing You': 'thể hiện nỗi nhớ nhung sâu sắc qua từng cánh hoa tinh tế và đầy cảm xúc.',
                      'Năm Tháng': 'ghi dấu những khoảnh khắc đáng nhớ với vẻ đẹp cổ điển và thanh lịch.',
                      'Yêu Thầm': 'thể hiện tình cảm kín đáo và sâu lắng qua màu sắc nhẹ nhàng, tinh tế.'
                  };

                  const desc = descriptions[productName];
                  if (desc) {
                      const descSection = document.querySelector('.product-description');
                      descSection.innerHTML = `
                          <h4>Mô tả sản phẩm</h4>
                          <p>Bó hoa <strong>"${productName}"</strong> ${desc} Phù hợp cho sinh nhật, kỷ niệm và các dịp đặc biệt.</p>
                      `;
                  }
              }

              // Quantity controls
              let currentQuantity = 1;

              function changeQuantity(change) {
                  currentQuantity = Math.max(1, currentQuantity + change);
                  document.getElementById('quantity').textContent = currentQuantity;

                  const minusBtn = document.querySelector('.qty-btn');
                  minusBtn.disabled = currentQuantity <= 1;
              }

              // Order functionality
              function orderNow() {
                  const productName = document.getElementById('productTitle').textContent;
                  const productPrice = document.getElementById('productPrice').textContent;
                  const productImage = document.getElementById('productImage').src;

                  // Parse price to number (remove VND and commas)
                  const priceNumber = parseInt(productPrice.replace(/[^\d]/g, ''));

                  // Create product object
                  const product = {
                      id: productName.toLowerCase().replace(/\s+/g, '-'),
                      name: productName,
                      price: priceNumber,
                      image: productImage,
                      quantity: currentQuantity
                  };

            // If not logged in, save pending add and redirect to login
            const user = JSON.parse(localStorage.getItem('floralShopUser') || 'null');
            if (!user || !user.username) {
              // Save pending add so we can merge after login
              try {
                localStorage.setItem('floralShopPendingAdd', JSON.stringify(product));
              } catch (e) {
                console.error('Không thể lưu pending add:', e);
              }
              // Redirect to login with next return URL
              const next = encodeURIComponent(window.location.href);
              window.location.href = `dangnhap.html?next=${next}`;
              return;
            }

          // Add to cart using shared CartManager (persists per-user and shows notification)
          if (typeof cartManager !== 'undefined' && cartManager && typeof cartManager.addItem === 'function') {
            cartManager.addItem(product);
          } else {
            // Fallback: write to legacy key if CartManager isn't available
            try {
              const cart = JSON.parse(localStorage.getItem('floralShopCart') || '[]');
              const existingIndex = cart.findIndex(item => item.id === product.id);
              if (existingIndex >= 0) cart[existingIndex].quantity += product.quantity;
              else cart.push(product);
              localStorage.setItem('floralShopCart', JSON.stringify(cart));
              // show a local notification as fallback
              showAddToCartNotification(product.name, product.quantity);
            } catch (e) {
              console.error('Fallback addToCart failed:', e);
            }
          }

                  // Button animation
                  const btn = document.querySelector('.main-order-btn');
                  btn.style.transform = 'scale(0.95)';
                  btn.innerHTML = '<i class="fas fa-check"></i> ĐÃ THÊM VÀO GIỎ!';

                  setTimeout(() => {
                      btn.style.transform = '';
                      btn.innerHTML = '<i class="fas fa-shopping-cart"></i> ĐẶT HOA NGAY';
                  }, 2000);
              }

              // Note: cart updates use the shared CartManager (cart.js) via cartManager.addItem(product)

              // Show add to cart notification
              function showAddToCartNotification(productName, quantity) {
                  const notification = document.createElement('div');
                  notification.innerHTML = `
                      <i class="fas fa-check-circle" style="margin-right: 8px;"></i>
                      Đã thêm ${quantity} "${productName}" vào giỏ hàng!
                  `;
                  notification.style.cssText = `
                      position: fixed;
                      top: 20px;
                      right: 20px;
                      background: linear-gradient(135deg, #00b4a6, #4fd1c7);
                      color: white;
                      padding: 15px 20px;
                      border-radius: 10px;
                      box-shadow: 0 8px 25px rgba(0, 180, 166, 0.3);
                      z-index: 10000;
                      font-weight: 700;
                      font-size: 14px;
                      transform: translateX(100%);
                      transition: transform 0.3s ease;
                  `;

                  document.body.appendChild(notification);

                  // Slide in
                  setTimeout(() => {
                      notification.style.transform = 'translateX(0)';
                  }, 100);

                  // Slide out after 3 seconds
                  setTimeout(() => {
                      notification.style.transform = 'translateX(100%)';
                      setTimeout(() => {
                          if (notification.parentNode) {
                              notification.parentNode.removeChild(notification);
                          }
                      }, 300);
                  }, 3000);
              }          // Initialize page
              document.addEventListener('DOMContentLoaded', function() {
                  getProductFromURL();
              });

              // Go back to products section on index page
              function goBackToProducts() {
                  window.location.href = 'index.html#products';
              }
        </script>
      </div>
      <!-- End modal-container -->
    </div>
    <!-- End modal-overlay -->
  </body>
</html>
